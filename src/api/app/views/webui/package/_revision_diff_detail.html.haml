- diff_content = file.dig('diff', '_content')
.position-relative
  = render partial: 'webui/package/revision_diff_detail_buttons',
  locals: { file_view_path: file_view_path, filename: filename, index: index, last: last, has_content: diff_content.present?, linkinfo: linkinfo }
  - if diff_content.present?
    %details.card{ open: expand_diff?(filename, file['state']), id: "revision_details_#{index}", data: { package: package } }
      %summary.card-header.py-3
        .diff-card-header
          = calculate_filename(filename, file)
          %span.badge{ class: "badge-#{file['state']}" }= file['state'].capitalize
      = render_diff(diff_content, file_index: index)
      - if file.dig('diff', 'lines').to_i > file.dig('diff', 'shown').to_i
        .alert.alert-warning.m-3
          %i.fa.fa-exclamation-triangle.text-warning
          This diff is truncated.
          :ruby
            if bs_request
              full_diff_path = request_show_path(number: bs_request.number, full_diff: true)
            else
              full_diff_path = request.original_url.sub(/([?&])full_diff=false/, '\1full_diff=true')
              unless full_diff_path.include?('full_diff=true')
                full_diff_path += full_diff_path.include?('?') ? '&full_diff=true' : '?full_diff=true'
              end
            end
          = link_to 'See full diff', full_diff_path
  - else
    .card{ id: "revision_details_#{index}" }
      .card-header.py-3
        .div.w-75
          = calculate_filename(filename, file)
          %span.badge{ class: "badge-#{file['state']}" }= file['state'].capitalize
